---
import {getLanguage, useTranslations} from "../i18n/utils";
import {Picture} from 'astro:assets';
import {getEntry, getCollection} from 'astro:content';
import Layout from '../layouts/Layout.astro';
import logoOrange from '../images/sl-orange.svg?raw';
import portraitSansFond from '../images/portrait-sans-fond.avif';
import dotsGrid from '../images/dots-grid.svg?raw';
import stackIcon from '../images/sections-icons/stack.svg?raw';
import monolithsIcon from '../images/sections-icons/monoliths.svg?raw';
import ExperienceCard from "../components/ExperienceCard.astro";
import laravelLogo from '../images/brands-logo/laravel.svg?raw';
import vuejsLogo from '../images/brands-logo/vuejs.svg?raw';
import nestjsLogo from '../images/brands-logo/nestjs.svg?raw';
import bootstrapLogo from '../images/brands-logo/bootstrap.svg?raw';
import prismaLogo from '../images/brands-logo/prisma.svg?raw';
import sequelizeLogo from '../images/brands-logo/sequelize.svg?raw';
import phpLogo from '../images/brands-logo/php.svg?raw';
import typescriptLogo from '../images/brands-logo/typescript.svg?raw';
import sassLogo from '../images/brands-logo/sass.svg?raw';
import javaLogo from '../images/brands-logo/java.svg?raw';
import csharpLogo from '../images/brands-logo/csharp.svg?raw';
import tuxLogo from '../images/brands-logo/tux.svg?raw';
import figmaLogo from '../images/brands-logo/figma.svg?raw';
import gitlabLogo from '../images/brands-logo/gitlab.svg?raw';
import faBars from '@fortawesome/free-solid-svg-icons/faBars'
import FontAwesome from "../components/FontAwesome.astro";
import SectionHeader from "../components/SectionHeader.astro";
import ProjectCard from "../components/ProjectCard.astro";
import atomIcon from '../images/sections-icons/atom.svg?raw';
import EducationCareerCard from "../components/EducationCareerCard.astro";

const lang = getLanguage(Astro.preferredLocale);
const trans = useTranslations(lang);

const allSoftSkills = await getEntry('homepage', lang + '/soft-skills')
    .then((entry) => entry.data);

const technoLogo = {
    "laravel": laravelLogo,
    "vuejs": vuejsLogo,
    "nestjs": nestjsLogo,
    "bootstrap": bootstrapLogo,
    "prisma": prismaLogo,
    "sequelize": sequelizeLogo,
    "php": phpLogo,
    "typescript": typescriptLogo,
    "sass": sassLogo,
    "java": javaLogo,
    "csharp": csharpLogo,
    "linux": tuxLogo,
    "figma": figmaLogo,
    "gitlab": gitlabLogo,
}

const softSkillsCategoriesTitles = {
    "framework": trans('framework-and-libraries'),
    "language": trans('programming-languages'),
    "additional": trans('additional-skills'),
}

const projects = await getCollection("projects", ({id}) => {
    return id.startsWith(lang + '/');
});

const education = await getCollection("education", ({id}) => {
    return id.startsWith(lang + '/');
});

const career = await getCollection("career", ({id}) => {
    return id.startsWith(lang + '/');
});

function formatDate(isoDate=null) {
    if(isoDate === null) return trans('today-short');
    let date = new Date(isoDate).toLocaleDateString(lang, {month: 'short', year: 'numeric'});
    return date.charAt(0).toUpperCase() + date.slice(1);
}

const sortedAndFormattedEducation = education.sort((a, b) => new Date(b.data.startDate) - new Date(a.data.startDate))
    .map((education) => ({
        ...education,
        data: {
            ...education.data,
            startDate: formatDate(education.data.startDate),
            endDate: formatDate(education.data.endDate),
        }
    }));

const sortedAndFormattedCareer = career.sort((a, b) => new Date(b.data.startDate) - new Date(a.data.startDate))
    .map((career) => ({
        ...career,
        data: {
            ...career.data,
            startDate: formatDate(career.data.startDate),
            endDate: formatDate(career.data.endDate),
        }
    }));
---

<Layout title="Sofiane Lasri">
    <header class="navbar">
        <div class="logo-section">
            <div class="logo">
                <Fragment set:html={logoOrange}/>
            </div>
            <div class="portfolio-name">
                <div class="name">Sofiane Lasri.</div>
                <div class="desc">Développeur Full-Stack</div>
            </div>
        </div>
        <nav aria-label="Navigation principale">
            <ul>
                <li><a href="/" class="active">{trans('nav.home')}</a></li>
                <li><a href="/#experience">Expérience</a></li>
                <li><a href="/#projects">Projets</a></li>
                <li><a href="/#education-carreer">Éducation & Carrière</a></li>
                <li><a href="/#contact">Contact</a></li>
            </ul>
        </nav>
        <button class="btn menu-mobile-btn">
            <FontAwesome icon={faBars}/>
        </button>
    </header>
    <main>
        <section class="hero-wrapper">
            <div class="hero">
                <div class="portrait">
                    <Fragment set:html={dotsGrid}/>
                    <div class="portrait-wrapper">
                        <Picture src={portraitSansFond} formats={['avif', 'webp']} loading="eager"
                                 alt="Portrait de Sofiane Lasri, sans aucune égocentrie."/>
                    </div>
                </div>
                <div class="content">
                    <div class="heading">
                        <div class="meta-title">Bienvenue sur mon site</div>
                        <h1 class="title">Salut! Je suis <span class="bg-gradient-primary">Sofiane Lasri</span>,</h1>
                        <h2 class="subtitle">Développeur Full-Stack</h2>
                    </div>
                    <div class="about-me">
                        <p>Passionné par le développement d’applications, j’adore créer de nouveaux projets afin
                            d’expérimenter de nouvelles technologies. J’aime également concevoir et réaliser des
                            interfaces graphiques, j’attribue toujours beaucoup de mérite aux sites et applications à
                            l’UI/UX soignée.</p>
                        <p>Grâce à mon expérience acquise en entreprise, mais également au travers de mes divers projets
                            personnels, je possède une bonne maîtrise de Laravel, TypeScript et de Sass. :)</p>
                    </div>

                    <div class="d-flex flex-wrap gap-2">
                        <a href="https://1drv.ms/b/s!Atk178NpnuLmhJoiwLEN2FRww-mGcA?e=I1kL8w" target="_blank"
                           class="btn" aria-label="Télécharger mon CV">Télécharger mon CV</a>
                        <a href="https://github.com/SofianeLasri/" target="_blank" class="btn"
                           aria-label="GitHub">GitHub</a>
                        <a href="https://www.linkedin.com/in/sofiane-lasri-trienpont/" target="_blank"
                           class="btn" aria-label="LinkedIn">LinkedIn</a>
                        <a href="https://dribbble.com/SofianeLasri" target="_blank" class="btn"
                           aria-label="Dribbble">Dribbble</a>
                    </div>
                </div>
            </div>
        </section>

        <section id="experience" class="body-section three-columns">
            <SectionHeader title="Expérience & Compétences" metaTitle="Expérience" icon={stackIcon}/>
            {Object.keys(allSoftSkills).map((technoType) => (
                    <div class="sub-section">
                        <h2 class="subtitle">{softSkillsCategoriesTitles[technoType]}</h2>
                        <div class="cards">
                            {allSoftSkills[technoType].map((softSkill) => (
                                    <ExperienceCard
                                            isPrimary={softSkill.preferred}
                                            technoType={softSkill.translatedTechnoType}
                                            logo={technoLogo[softSkill.id]}
                                            name={softSkill.name}
                                            review={softSkill.review}
                                    />
                            ))}
                        </div>
                    </div>
            ))}
        </section>

        <section id="projects" class="body-section three-columns">
            <SectionHeader title="Mes projets" metaTitle="Portfolio" icon={monolithsIcon}/>
            <div class="sub-section">
                <div class="cards">
                    {projects.map((project) => (
                            <ProjectCard cover={project.data.cover} projectType={project.data.category}
                                         name={project.data.name} description={project.data.description}/>
                    ))}
                </div>
            </div>
        </section>

        <section id="education-carreer" class="body-section two-columns">
            <SectionHeader title="Formation & Carrière" metaTitle="Expérience professionnelle" icon={atomIcon}/>
            <div class="sub-section">
                <div class="cards">
                    <h2 class="subtitle">Éducation</h2>
                    {sortedAndFormattedEducation.map((education) => (
                            <EducationCareerCard name={education.data.name}
                                                 description={education.data.description}
                                                 logo={education.data.logo}
                                                 startDate={education.data.startDate}
                                                 endDate={education.data.endDate}/>
                    ))}
                </div>
                <div class="cards">
                    <h2 class="subtitle">Carrière</h2>
                    {sortedAndFormattedCareer.map((career) => (
                            <EducationCareerCard name={career.data.name}
                                                 description={career.data.description}
                                                 logo={career.data.logo}
                                                 startDate={career.data.startDate}
                                                 endDate={career.data.endDate}/>
                    ))}
                </div>
            </div>
        </section>
    </main>
</Layout>